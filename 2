<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Quét QR</title>
  <script src="https://unpkg.com/html5-qrcode" defer></script>
  <style>
    body{margin:0;min-height:100svh;display:grid;place-items:center;background:#0b1220;color:#e5e7eb;font:16px/1.6 system-ui,Arial}
    .card{max-width:720px;width:100%;margin:24px;padding:24px;border-radius:16px;border:1px solid rgba(148,163,184,.2);background:rgba(255,255,255,.03)}
    #reader{width:100%}
    .muted{color:#94a3b8}
    a{color:#7dd3fc}
  </style>
</head>
<body>
  <main class="card">
    <h1>Quét QR</h1>
    <p class="muted">Cho phép quyền camera nếu được hỏi. Khi quét xong sẽ tự chuyển tới URL trong mã QR.</p>
    <div id="reader"></div>
    <p>↩️ <a href="index.html">Về trang chính</a></p>
  </main>

  <script>
    window.addEventListener('load', async () => {
      const onScanSuccess = (decodedText) => {
        try {
          // Nếu decodedText là URL hợp lệ thì điều hướng
          const url = new URL(decodedText);
          window.location.href = url.toString();
        } catch {
          alert('QR không phải URL. Nội dung: ' + decodedText);
        }
      };
      const onScanFailure = () => {}; // bỏ qua lỗi tạm thời

      // Khởi tạo scanner
      const html5QrcodeScanner = new Html5QrcodeScanner(
        "reader",
        { fps: 10, qrbox: { width: 260, height: 260 }, rememberLastUsedCamera: true },
        /* verbose= */ false
      );
      html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    });
  </script>
</body>
</html>
